@import common._
@import forms.common.SemanticForms._
@import forms.CoinAddForm
@import models.coin.WorkEntry

@(user: models.User, workEntries: Seq[WorkEntry], coinAddForm: Form[forms.CoinAddForm.Data])(implicit request: RequestHeader, messages: Messages, lang: play.api.i18n.Lang)


@mainLayout(title = Messages("home.title"), head = Html("""
<script type="text/javascript" src="/assets/lib/semantic-ui-calendar/dist/calendar.min.js"></script>
<link rel="stylesheet" href="/assets/lib/semantic-ui-calendar/dist/calendar.min.css" />
""")) {
    @mainMenu(Option(user))

    <div class="ui container menu-spacer">
        @helper.form(action = routes.CoinController.add(), 'class -> "ui form" ) {
        @helper.CSRF.formField
            <div class="two fields">
                @helper.select(
                    field = coinAddForm("area"),
                    options = CoinAddForm.areaValues,
                    'class -> "ui fluid dropdown",
                    '_label -> Messages("coin.label.area"),
                    '_default -> Messages("coin.select")
                )
                @helper.select(
                    field = coinAddForm("task"),
                    options = CoinAddForm.taskValues,
                    'class -> "ui fluid dropdown",
                    '_label -> Messages("coin.label.task"),
                    '_default -> Messages("coin.select")
                )
            </div>
            <div class="three fields">
                @helper.select(
                    field = coinAddForm("time"),
                    options = CoinAddForm.timeValues,
                    'class -> "ui fluid dropdown",
                    '_label -> Messages("coin.label.time"),
                    '_default -> Messages("coin.select")
                )
                @helper.select(
                    field = coinAddForm("coin"),
                    options = CoinAddForm.coinValues,
                    'class -> "ui fluid dropdown",
                    '_label -> Messages("coin.label.coin"),
                    '_default -> Messages("coin.select")
                )
                @helper.input(coinAddForm("date"), '_label -> Messages("coin.label.date"), 'placeholder -> Messages("coin.select")) { (id, name, value, args) =>
                <div class="ui calendar left icon input" id="datePicker">
                    <i class="calendar icon"></i>
                    <input type="text" name="@name" id="@id" value="@value" @toHtmlArgs(args)>
                </div>
                }
            </div>
            @helper.inputText(coinAddForm("description"), '_label -> Messages("coin.label.desc"), 'placeholder -> "Klo putzen etc.")

            <button id="submit" type="submit" value="submit" class="ui icon button">
                <i class="plus icon"></i>
                @Messages("coin.submit")
            </button>
        }

        @if(workEntries.nonEmpty) {
        <table class="ui compact unstackable table">
            <thead>
            <tr>
                <th class="collapsing">@Messages("coin.label.area")</th>
                <th class="collapsing">@Messages("coin.label.task")</th>
                <th>@Messages("coin.label.desc")</th>
                <th class="collapsing">@Messages("coin.label.time")</th>
                <th class="collapsing">@Messages("coin.label.coin")</th>
                <th class="collapsing">@Messages("coin.label.date")</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            @for(workEntry <- workEntries) {
            <tr>
                <td class="collapsing">@workEntry.area</td>
                <td class="collapsing">@workEntry.task</td>
                <td>@workEntry.description</td>
                <td class="collapsing">@workEntry.timeSpent</td>
                <td class="collapsing">@workEntry.coins</td>
                <td class="collapsing">@workEntry.dateDone.toString("dd.MM.yyyy", lang.toLocale)</td>
                <td class="collapsing">
                    <a href="/coin/remove/@workEntry.id"><i class="remove icon"></i></a>
                </td>
            </tr>
            }
            </tbody>
        </table>
        }
    </div>

    <script>
        $('.ui.dropdown').dropdown();
        $('#datePicker').calendar({
          type: 'date',
          monthFirst: false,
          popupOptions: {
              position: 'bottom center',
              lastResort: 'bottom center',
              prefer: 'opposite',
              hideOnScroll: false
            },
          formatter: {
            date: function (date, settings) {
              if (!date) return '';
              var day = ("0" + date.getDate()).slice(-2);
              var month = ("0" + (date.getMonth() + 1)).slice(-2);
              var year = date.getFullYear();
              return day + '.' + month + '.' + year;
            }
          }
        });
    </script>
}